
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absent Teachers</title>
</head>
<body>
    <h1>Absent Teachers List</h1>
    <button id="fetchPDF">Fetch PDF for Today</button>
    <ul id="absentTeachers"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        function getFormattedDate(date) {
            var month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
            var day = String(date.getDate()).padStart(2, '0');
            return day + "." + month;
        }

        function getPDFUrl(date) {
            var formattedDate = getFormattedDate(date);
            return "https://www.ceciliengymnasium.de/attachments/article/1512/Vertretungsplan_" + formattedDate + ".2024.pdf";
        }

        document.getElementById('fetchPDF').addEventListener('click', async function () {
            const today = new Date();
            const pdfUrl = getPDFUrl(today);

            try {
                const response = await fetch(pdfUrl);
                if (!response.ok) {
                    alert("Failed to fetch the PDF. Please check the URL or try again later.");
                    return;
                }

                const pdfData = await response.arrayBuffer();
                extractTeachers(new Uint8Array(pdfData));
            } catch (error) {
                console.error("Error fetching PDF:", error);
                alert("An error occurred while fetching the PDF.");
            }
        });

        async function extractTeachers(pdfData) {
            const loadingTask = pdfjsLib.getDocument({ data: pdfData });
            const pdf = await loadingTask.promise;
            let textContent = "";

            // Extract text from each page
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                text.items.forEach(item => {
                    textContent += item.str + " ";
                });
            }

            // Extract columns for Leh and Vert
            const teacherLines = textContent.split("\n").filter(line => line.includes("Leh"));
            const lehTeachers = [];
            const vertTeachers = [];

            teacherLines.forEach(line => {
                const parts = line.split(/\s+/); // Split by whitespace
                const leh = parts[parts.length - 2]; // Assuming "Leh" is the second last
                const vert = parts[parts.length - 1]; // Assuming "Vert" is last
                if (leh) lehTeachers.push(leh);
                if (vert) vertTeachers.push(vert);
            });

            // Find absent teachers
            const absentTeachers = lehTeachers.filter(teacher => !vertTeachers.includes(teacher));

            // Display absent teachers
            const ul = document.getElementById('absentTeachers');
            ul.innerHTML = ""; // Clear previous list
            absentTeachers.forEach(teacher => {
                const li = document.createElement('li');
                li.textContent = teacher;
                ul.appendChild(li);
            });
        }
    </script>
</body>
</html>
